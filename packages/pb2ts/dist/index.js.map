{"version":3,"sources":["../node_modules/tsup/assets/esm_shims.js","../src/config/defineConfig.ts","../src/parser/runParser.ts","../src/generator/service.ts","../src/generator/index.ts","../src/generator/context.ts"],"sourcesContent":["// Shim globals in esm bundle\nimport path from 'node:path'\nimport { fileURLToPath } from 'node:url'\n\nconst getFilename = () => fileURLToPath(import.meta.url)\nconst getDirname = () => path.dirname(getFilename())\n\nexport const __dirname = /* @__PURE__ */ getDirname()\nexport const __filename = /* @__PURE__ */ getFilename()\n","import {Pb2tsConfig} from \"./types\";\r\nexport function defineConfig(config: Pb2tsConfig) {\r\n    return config\r\n}","import { spawn } from 'child_process'\nimport path from 'path'\nimport fs from 'fs'\nimport type { ParseResult } from './types'\n\nexport async function runParser(protoPath: string, includePaths: string[] = []): Promise<ParseResult> {\n    const packageRoot = path.resolve(__dirname, '..', '..')\n\n    const possiblePaths = [\n        path.resolve(packageRoot, 'bin/pb2ts-parser.exe'),\n        path.resolve(packageRoot, 'bin/pb2ts-parser'),\n        path.resolve(packageRoot, '../../bin/pb2ts-parser.exe'),\n        path.resolve(packageRoot, '../../bin/pb2ts-parser'),\n        path.resolve(process.cwd(), 'bin/pb2ts-parser.exe'),\n        path.resolve(process.cwd(), 'bin/pb2ts-parser'),\n        'pb2ts-parser',\n    ]\n\n    let binPath = ''\n    for (const p of possiblePaths) {\n        if (p === 'pb2ts-parser') {\n            binPath = p\n            break\n        }\n        if (fs.existsSync(p)) {\n            binPath = p\n            break\n        }\n    }\n\n    if (!binPath) {\n        throw new Error('Could not find pb2ts-parser binary')\n    }\n\n    const args = ['--proto', protoPath]\n    if (includePaths.length > 0) {\n        args.push('--imports', includePaths.join(','))\n    }\n\n    return new Promise((resolve, reject) => {\n        const child = spawn(binPath, args)\n\n        let stdout = ''\n        let stderr = ''\n\n        child.stdout.on('data', (data) => {\n            stdout += data.toString()\n        })\n\n        child.stderr.on('data', (data) => {\n            stderr += data.toString()\n        })\n\n        child.on('close', (code) => {\n            if (code !== 0) {\n                reject(new Error(`Parser exited with code ${code}: ${stderr}`))\n                return\n            }\n\n            try {\n                const result = JSON.parse(stdout) as ParseResult\n                resolve(result)\n            } catch (err) {\n                reject(new Error(`Failed to parse JSON output: ${err}\\nOutput: ${stdout}`))\n            }\n        })\n\n        child.on('error', (err) => {\n            reject(err)\n        })\n    })\n}\n","import type { Service } from '../parser/types'\nimport { CodeBuilder } from './context'\nimport type { Pb2tsConfig } from '../config/types'\n\nexport function generateService(service: Service, builder: CodeBuilder, config: Pb2tsConfig) {\n\n}\n","import { runParser } from '../parser/runParser'\nimport type { Pb2tsConfig } from '../config/types'\nimport { generateService } from './service'\nimport path from 'path'\nimport { CodeBuilder } from './context'\n\nexport async function generate(config: Pb2tsConfig) {\n    const protoRoot = path.resolve(process.cwd(), config.proto.root)\n    \n    // 1. Parse\n    // config.proto.include could be passed as imports if they are directories\n    // But currently include is glob patterns.\n    // We'll just pass root to parser.\n    const services = await runParser(protoRoot)\n\n    const builder = new CodeBuilder()\n    \n    // 2. Generate\n    for (const service of services) {\n        generateService(service, builder, config)\n    }\n\n    // 3. Emit\n    const outFile = path.join(config.output.dir, 'index.ts')\n    await emitFile(outFile, builder.toString())\n}\n\n\nasync function emitFile (filePath: string, content: string) {\n    console.log(filePath,content)\n}","import type { Pb2tsConfig } from '../config/types'\nimport type { Service } from '../parser/types'\n\nexport interface GeneratorContext {\n    config: Pb2tsConfig\n    services: Service[]\n}\n\nexport class CodeBuilder {\n    private lines: string[] = []\n    private indentLevel = 0\n\n    indent() {\n        this.indentLevel++\n    }\n\n    unindent() {\n        this.indentLevel = Math.max(0, this.indentLevel - 1)\n    }\n\n    push(line: string = '') {\n        if (line === '') {\n            this.lines.push('')\n            return\n        }\n        const spaces = '    '.repeat(this.indentLevel)\n        this.lines.push(spaces + line)\n    }\n\n    block(start: string, callback: () => void, end: string = '}') {\n        this.push(start)\n        this.indent()\n        callback()\n        this.unindent()\n        this.push(end)\n    }\n\n    toString() {\n        return this.lines.join('\\n')\n    }\n}\n"],"mappings":"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","names":["path","path","path"]}